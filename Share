@* Shared/Charts/FeatureUsageChart.razor *@
@inject IOracleDataService DataService
@inject IJSRuntime JSRuntime

<h5 class="fw-semibold">Feature Usage</h5>
<div class="mb-3">
    <button class="btn btn-sm btn-primary me-2" @onclick="() => GenerateGraph(false)">Show Normal</button>
    <button class="btn btn-sm btn-secondary" @onclick="() => GenerateGraph(true)">Show Zoomed</button>
</div>

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <div class="alert alert-danger">@ErrorMessage</div>
}

<div id="featureUsageChart" style="width: 100%; height: 400px;"></div>

@code {
    private string? ErrorMessage;

    private async Task GenerateGraph(bool logScale)
    {
        try
        {
            var data = await DataService.GetFeatureUsageAsync();
            var labels = data.Select(d => d.Feature).ToList();
            var values = data.Select(d => (double)d.UsageCount).ToList();

            var chartData = new
            {
                labels,
                values,
                title = "Feature Usage (Last 30 Days)",
                xLabel = "Feature",
                yLabel = "Usage Count"
            };

            await JSRuntime.InvokeVoidAsync("renderPlotlyBarChart", "featureUsageChart", chartData, logScale);
        }
        catch (Exception ex)
        {
            ErrorMessage = ex.Message;
        }
    }
}









