@page "/counter"
@inject IOracleDataService DataService
@inject IJSRuntime JSRuntime

<h3 class="mt-3">ðŸ“Š Feature Usage (Last 30 Days)</h3>

<div class="mb-4">
    <button class="btn btn-primary me-2" @onclick="() => GenerateGraph(false)">Show Normal Scale</button>
    <button class="btn btn-outline-secondary" @onclick="() => GenerateGraph(true)">Show Zoomed Scale</button>
</div>

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <div class="alert alert-danger">@ErrorMessage</div>
}

<div id="featureUsageChart" style="width: 100%; height: 500px;"></div>

@code {
    private string? ErrorMessage;
    private List<string> labels = new();
    private List<double> values = new();

    private async Task GenerateGraph(bool useLogScale)
    {
        ErrorMessage = null;
        try
        {
            var data = await DataService.GetFeatureUsageAsync();
            if (data == null || data.Count == 0)
            {
                ErrorMessage = "No data found.";
                return;
            }

            labels = data.Select(d => d.Feature).ToList();
            values = data.Select(d => (double)d.UsageCount).ToList();

            var chartData = new
            {
                labels,
                values,
                title = "Feature Usage in Last 30 Days",
                xLabel = "Feature",
                yLabel = "Usage Count"
            };

            await JSRuntime.InvokeVoidAsync("renderPlotlyBarChart", "featureUsageChart", chartData, useLogScale);
        }
        catch (Exception ex)
        {
            ErrorMessage = ex.Message;
        }
    }
}
