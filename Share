import sys
import pandas as pd
import matplotlib.pyplot as plt

def main(inp, outp):
    # read CSV
    df = pd.read_csv(inp)

    # if no data, render “No data” image
    if df.empty:
        fig, ax = plt.subplots(figsize=(8,4))
        ax.text(0.5, 0.5, 'No data for this period',
                ha='center', va='center', fontsize=14)
        ax.axis('off')
        plt.savefig(outp)
        return

    # plot bar chart
    ax = df.plot(
        x='MarketEventName',
        y='MEVS',
        kind='bar',
        figsize=(10,6)
    )

    # add value labels on each bar
    for container in ax.containers:
        ax.bar_label(container, fmt="%.0f", label_type="edge", padding=2, fontsize=9)

    # formatting
    plt.xticks(rotation=45, ha='right')
    plt.ylabel('Number of Events')
    plt.xlabel('Market Event')
    plt.tight_layout()
    plt.savefig(outp)

if __name__ == '__main__':
    if len(sys.argv) != 3:
        print("Usage: python generate_market_event_chart.py <in.csv> <out.png>", file=sys.stderr)
        sys.exit(1)
    main(sys.argv[1], sys.argv[2])
